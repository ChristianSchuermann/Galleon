import{Fragment as Q,computed as h,defineComponent as L,h as H,inject as A,provide as V,ref as I,watchEffect as _}from"vue";import{match as x}from'../../utils/match.js';import{render as R,omit as ne,Features as j}from'../../utils/render.js';import{useId as C}from'../../hooks/use-id.js';import{Keys as T}from'../../keyboard.js';import{getFocusableElements as re,Focus as F,focusIn as w,isFocusableElement as le,FocusableMode as ae}from'../../utils/focus-management.js';import{dom as r}from'../../utils/dom.js';import{useOpenClosedProvider as ue,State as G,useOpenClosed as X}from'../../internal/open-closed.js';import{useResolveButtonType as ie}from'../../hooks/use-resolve-button-type.js';import{useOutsideClick as se}from'../../hooks/use-outside-click.js';import{getOwnerDocument as N}from'../../utils/owner.js';import{useEventListener as pe}from'../../hooks/use-event-listener.js';import{Hidden as q,Features as U}from'../../internal/hidden.js';import{useTabDirection as Y,Direction as M}from'../../hooks/use-tab-direction.js';import'../../utils/micro-task.js';var fe=(f=>(f[f.Open=0]="Open",f[f.Closed=1]="Closed",f))(fe||{});let Z=Symbol("PopoverContext");function W(P){let S=A(Z,null);if(S===null){let f=new Error(`<${P} /> is missing a parent <${ce.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(f,W),f}return S}let ee=Symbol("PopoverGroupContext");function te(){return A(ee,null)}let oe=Symbol("PopoverPanelContext");function ve(){return A(oe,null)}let ce=L({name:"Popover",props:{as:{type:[Object,String],default:"div"}},setup(P,{slots:S,attrs:f,expose:E}){var p;let t=`headlessui-popover-button-${C()}`,e=`headlessui-popover-panel-${C()}`,m=I(null);E({el:m,$el:m});let a=I(1),b=I(null),g=I(null),y=I(null),s=I(null),c=h(()=>N(m)),O=h(()=>{if(!r(b)||!r(s))return!1;for(let n of document.querySelectorAll("body > *"))if(Number(n==null?void 0:n.contains(r(b)))^Number(n==null?void 0:n.contains(r(s))))return!0;return!1}),d={popoverState:a,buttonId:t,panelId:e,panel:s,button:b,isPortalled:O,beforePanelSentinel:g,afterPanelSentinel:y,togglePopover(){a.value=x(a.value,{[0]:1,[1]:0})},closePopover(){a.value!==1&&(a.value=1)},close(n){d.closePopover();let i=(()=>n?n instanceof HTMLElement?n:n.value instanceof HTMLElement?r(n):r(d.button):r(d.button))();i==null||i.focus()}};V(Z,d),ue(h(()=>x(a.value,{[0]:G.Open,[1]:G.Closed})));let D={buttonId:t,panelId:e,close(){d.closePopover()}},l=te(),o=l==null?void 0:l.registerPopover;function u(){var n,i,v,k;return(k=l==null?void 0:l.isFocusWithinPopoverGroup())!=null?k:((n=c.value)==null?void 0:n.activeElement)&&(((i=r(b))==null?void 0:i.contains(c.value.activeElement))||((v=r(s))==null?void 0:v.contains(c.value.activeElement)))}return _(()=>o==null?void 0:o(D)),pe((p=c.value)==null?void 0:p.defaultView,"focus",n=>{var i,v;a.value===0&&(u()||!b||!s||(i=r(d.beforePanelSentinel))!=null&&i.contains(n.target)||(v=r(d.afterPanelSentinel))!=null&&v.contains(n.target)||d.closePopover())},!0),se([b,s],(n,i)=>{var v;d.closePopover(),le(i,ae.Loose)||(n.preventDefault(),(v=r(b))==null||v.focus())},h(()=>a.value===0)),()=>{let n={open:a.value===0,close:d.close};return R({theirProps:P,ourProps:{ref:m},slot:n,slots:S,attrs:f,name:"Popover"})}}}),Be=L({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(P,{attrs:S,slots:f,expose:E}){let t=W("PopoverButton"),e=h(()=>N(t.button));E({el:t.button,$el:t.button});let m=te(),a=m==null?void 0:m.closeOthers,b=ve(),g=b===null?!1:b===t.panelId,y=I(null),s=`headlessui-focus-sentinel-${C()}`;g||_(()=>{t.button.value=y.value});let c=ie(h(()=>({as:P.as,type:S.type})),y);function O(o){var u,p,n,i,v;if(g){if(t.popoverState.value===1)return;switch(o.key){case T.Space:case T.Enter:o.preventDefault(),(p=(u=o.target).click)==null||p.call(u),t.closePopover(),(n=r(t.button))==null||n.focus();break}}else switch(o.key){case T.Space:case T.Enter:o.preventDefault(),o.stopPropagation(),t.popoverState.value===1&&(a==null||a(t.buttonId)),t.togglePopover();break;case T.Escape:if(t.popoverState.value!==0)return a==null?void 0:a(t.buttonId);if(!r(t.button)||((i=e.value)==null?void 0:i.activeElement)&&!((v=r(t.button))!=null&&v.contains(e.value.activeElement)))return;o.preventDefault(),o.stopPropagation(),t.closePopover();break}}function d(o){g||o.key===T.Space&&o.preventDefault()}function D(o){var u,p;P.disabled||(g?(t.closePopover(),(u=r(t.button))==null||u.focus()):(o.preventDefault(),o.stopPropagation(),t.popoverState.value===1&&(a==null||a(t.buttonId)),t.togglePopover(),(p=r(t.button))==null||p.focus()))}function l(o){o.preventDefault(),o.stopPropagation()}return()=>{let o=t.popoverState.value===0,u={open:o},p=g?{ref:y,type:c.value,onKeydown:O,onClick:D}:{ref:y,id:t.buttonId,type:c.value,"aria-expanded":P.disabled?void 0:t.popoverState.value===0,"aria-controls":r(t.panel)?t.panelId:void 0,disabled:P.disabled?!0:void 0,onKeydown:O,onKeyup:d,onClick:D,onMousedown:l},n=Y();function i(){let v=r(t.panel);if(!v)return;function k(){x(n.value,{[M.Forwards]:()=>w(v,F.First),[M.Backwards]:()=>w(v,F.Last)})}k()}return H(Q,[R({ourProps:p,theirProps:{...S,...P},slot:u,attrs:S,slots:f,name:"PopoverButton"}),o&&!g&&t.isPortalled.value&&H(q,{id:s,features:U.Focusable,as:"button",type:"button",onFocus:i})])}}}),Le=L({name:"PopoverOverlay",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(P,{attrs:S,slots:f}){let E=W("PopoverOverlay"),t=`headlessui-popover-overlay-${C()}`,e=X(),m=h(()=>e!==null?e.value===G.Open:E.popoverState.value===0);function a(){E.closePopover()}return()=>{let b={open:E.popoverState.value===0};return R({ourProps:{id:t,"aria-hidden":!0,onClick:a},theirProps:P,slot:b,attrs:S,slots:f,features:j.RenderStrategy|j.Static,visible:m.value,name:"PopoverOverlay"})}}}),He=L({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1}},inheritAttrs:!1,setup(P,{attrs:S,slots:f,expose:E}){let{focus:t}=P,e=W("PopoverPanel"),m=h(()=>N(e.panel)),a=`headlessui-focus-sentinel-before-${C()}`,b=`headlessui-focus-sentinel-after-${C()}`;E({el:e.panel,$el:e.panel}),V(oe,e.panelId),_(()=>{var o,u;if(!t||e.popoverState.value!==0||!e.panel)return;let l=(o=m.value)==null?void 0:o.activeElement;(u=r(e.panel))!=null&&u.contains(l)||w(r(e.panel),F.First)});let g=X(),y=h(()=>g!==null?g.value===G.Open:e.popoverState.value===0);function s(l){var o,u;switch(l.key){case T.Escape:if(e.popoverState.value!==0||!r(e.panel)||m.value&&!((o=r(e.panel))!=null&&o.contains(m.value.activeElement)))return;l.preventDefault(),l.stopPropagation(),e.closePopover(),(u=r(e.button))==null||u.focus();break}}function c(l){var u,p,n,i,v;let o=l.relatedTarget;!o||!r(e.panel)||(u=r(e.panel))!=null&&u.contains(o)||(e.closePopover(),(((n=(p=r(e.beforePanelSentinel))==null?void 0:p.contains)==null?void 0:n.call(p,o))||((v=(i=r(e.afterPanelSentinel))==null?void 0:i.contains)==null?void 0:v.call(i,o)))&&o.focus({preventScroll:!0}))}let O=Y();function d(){let l=r(e.panel);if(!l)return;function o(){x(O.value,{[M.Forwards]:()=>{w(l,F.Next)},[M.Backwards]:()=>{var u;(u=r(e.button))==null||u.focus({preventScroll:!0})}})}o()}function D(){let l=r(e.panel);if(!l)return;function o(){x(O.value,{[M.Forwards]:()=>{var $,z;let u=r(e.button),p=r(e.panel);if(!u)return;let n=re(),i=n.indexOf(u),v=n.slice(0,i+1),K=[...n.slice(i+1),...v];for(let B of K.slice())if(((z=($=B==null?void 0:B.id)==null?void 0:$.startsWith)==null?void 0:z.call($,"headlessui-focus-sentinel-"))||(p==null?void 0:p.contains(B))){let J=K.indexOf(B);J!==-1&&K.splice(J,1)}w(K,F.First,!1)},[M.Backwards]:()=>w(l,F.Previous)})}o()}return()=>{let l={open:e.popoverState.value===0,close:e.close},o={ref:e.panel,id:e.panelId,onKeydown:s,onFocusout:t&&e.popoverState.value===0?c:void 0,tabIndex:-1};return R({ourProps:o,theirProps:{...S,...ne(P,["focus"])},attrs:S,slot:l,slots:{...f,default:(...u)=>{var p;return[H(Q,[y.value&&e.isPortalled.value&&H(q,{id:a,ref:e.beforePanelSentinel,features:U.Focusable,as:"button",type:"button",onFocus:d}),(p=f.default)==null?void 0:p.call(f,...u),y.value&&e.isPortalled.value&&H(q,{id:b,ref:e.afterPanelSentinel,features:U.Focusable,as:"button",type:"button",onFocus:D})])]}},features:j.RenderStrategy|j.Static,visible:y.value,name:"PopoverPanel"})}}}),xe=L({name:"PopoverGroup",props:{as:{type:[Object,String],default:"div"}},setup(P,{attrs:S,slots:f,expose:E}){let t=I(null),e=I([]),m=h(()=>N(t));E({el:t,$el:t});function a(s){let c=e.value.indexOf(s);c!==-1&&e.value.splice(c,1)}function b(s){return e.value.push(s),()=>{a(s)}}function g(){var O;let s=m.value;if(!s)return!1;let c=s.activeElement;return(O=r(t))!=null&&O.contains(c)?!0:e.value.some(d=>{var D,l;return((D=s.getElementById(d.buttonId))==null?void 0:D.contains(c))||((l=s.getElementById(d.panelId))==null?void 0:l.contains(c))})}function y(s){for(let c of e.value)c.buttonId!==s&&c.close()}return V(ee,{registerPopover:b,unregisterPopover:a,isFocusWithinPopoverGroup:g,closeOthers:y}),()=>R({ourProps:{ref:t},theirProps:P,slot:{},attrs:S,slots:f,name:"PopoverGroup"})}});export{ce as Popover,Be as PopoverButton,xe as PopoverGroup,Le as PopoverOverlay,He as PopoverPanel};
