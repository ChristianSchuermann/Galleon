import{Fragment as A,computed as m,defineComponent as P,h as w,inject as j,onMounted as D,onUnmounted as M,provide as B,ref as g,watchEffect as F}from"vue";import{Features as O,render as h,omit as C}from'../../utils/render.js';import{useId as k}from'../../hooks/use-id.js';import{Keys as c}from'../../keyboard.js';import{dom as S}from'../../utils/dom.js';import{match as K}from'../../utils/match.js';import{focusIn as I,Focus as b}from'../../utils/focus-management.js';import{useResolveButtonType as $}from'../../hooks/use-resolve-button-type.js';import{FocusSentinel as G}from'../../internal/focus-sentinel.js';import{microTask as N}from'../../utils/micro-task.js';let H=Symbol("TabsContext");function E(n){let i=j(H,null);if(i===null){let o=new Error(`<${n} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,E),o}return i}let te=P({name:"TabGroup",emits:{change:n=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(n,{slots:i,attrs:o,emit:f}){let e=g(null),s=g([]),a=g([]),p=m(()=>n.selectedIndex!==null),v=m(()=>p.value?n.selectedIndex:e.value),x={selectedIndex:e,orientation:m(()=>n.vertical?"vertical":"horizontal"),activation:m(()=>n.manual?"manual":"auto"),tabs:s,panels:a,setSelectedIndex(t){v.value!==t&&f("change",t),p.value||(e.value=t)},registerTab(t){s.value.includes(t)||s.value.push(t)},unregisterTab(t){let r=s.value.indexOf(t);r!==-1&&s.value.splice(r,1)},registerPanel(t){a.value.includes(t)||a.value.push(t)},unregisterPanel(t){let r=a.value.indexOf(t);r!==-1&&a.value.splice(r,1)}};return B(H,x),F(()=>{var R;if(x.tabs.value.length<=0||n.selectedIndex===null&&e.value!==null)return;let t=x.tabs.value.map(T=>S(T)).filter(Boolean),r=t.filter(T=>!T.hasAttribute("disabled")),u=(R=n.selectedIndex)!=null?R:n.defaultIndex;if(u<0)e.value=t.indexOf(r[0]);else if(u>x.tabs.value.length)e.value=t.indexOf(r[r.length-1]);else{let T=t.slice(0,u),d=[...t.slice(u),...T].find(y=>r.includes(y));if(!d)return;e.value=t.indexOf(d)}}),()=>{let t={selectedIndex:e.value};return w(A,[s.value.length<=0&&w(G,{onFocus:()=>{for(let r of s.value){let u=S(r);if((u==null?void 0:u.tabIndex)===0)return u.focus(),!0}return!1}}),h({theirProps:{...o,...C(n,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:t,slots:i,attrs:o,name:"TabGroup"})])}}}),le=P({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(n,{attrs:i,slots:o}){let f=E("TabList");return()=>{let e={selectedIndex:f.selectedIndex.value},s={role:"tablist","aria-orientation":f.orientation.value};return h({ourProps:s,theirProps:n,slot:e,attrs:i,slots:o,name:"TabList"})}}}),ae=P({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(n,{attrs:i,slots:o,expose:f}){let e=E("Tab"),s=`headlessui-tabs-tab-${k()}`,a=g(null);f({el:a,$el:a}),D(()=>e.registerTab(a)),M(()=>e.unregisterTab(a));let p=m(()=>e.tabs.value.indexOf(a)),v=m(()=>p.value===e.selectedIndex.value);function x(l){let d=e.tabs.value.map(y=>S(y)).filter(Boolean);if(l.key===c.Space||l.key===c.Enter){l.preventDefault(),l.stopPropagation(),e.setSelectedIndex(p.value);return}switch(l.key){case c.Home:case c.PageUp:return l.preventDefault(),l.stopPropagation(),I(d,b.First);case c.End:case c.PageDown:return l.preventDefault(),l.stopPropagation(),I(d,b.Last)}if(K(e.orientation.value,{vertical(){if(l.key===c.ArrowUp)return I(d,b.Previous|b.WrapAround);if(l.key===c.ArrowDown)return I(d,b.Next|b.WrapAround)},horizontal(){if(l.key===c.ArrowLeft)return I(d,b.Previous|b.WrapAround);if(l.key===c.ArrowRight)return I(d,b.Next|b.WrapAround)}}))return l.preventDefault()}function t(){var l;(l=S(a))==null||l.focus()}let r=g(!1);function u(){var l;r.value||(r.value=!0,!n.disabled&&((l=S(a))==null||l.focus(),e.setSelectedIndex(p.value),N(()=>{r.value=!1})))}function R(l){l.preventDefault()}let T=$(m(()=>({as:n.as,type:i.type})),a);return()=>{var y,L;let l={selected:v.value},d={ref:a,onKeydown:x,onFocus:e.activation.value==="manual"?t:u,onMousedown:R,onClick:u,id:s,role:"tab",type:T.value,"aria-controls":(L=(y=e.panels.value[p.value])==null?void 0:y.value)==null?void 0:L.id,"aria-selected":v.value,tabIndex:v.value?0:-1,disabled:n.disabled?!0:void 0};return h({ourProps:d,theirProps:n,slot:l,attrs:i,slots:o,name:"Tab"})}}}),ne=P({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(n,{slots:i,attrs:o}){let f=E("TabPanels");return()=>{let e={selectedIndex:f.selectedIndex.value};return h({theirProps:n,ourProps:{},slot:e,attrs:o,slots:i,name:"TabPanels"})}}}),re=P({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(n,{attrs:i,slots:o,expose:f}){let e=E("TabPanel"),s=`headlessui-tabs-panel-${k()}`,a=g(null);f({el:a,$el:a}),D(()=>e.registerPanel(a)),M(()=>e.unregisterPanel(a));let p=m(()=>e.panels.value.indexOf(a)),v=m(()=>p.value===e.selectedIndex.value);return()=>{var r,u;let x={selected:v.value},t={ref:a,id:s,role:"tabpanel","aria-labelledby":(u=(r=e.tabs.value[p.value])==null?void 0:r.value)==null?void 0:u.id,tabIndex:v.value?0:-1};return h({ourProps:t,theirProps:n,slot:x,attrs:i,slots:o,features:O.Static|O.RenderStrategy,visible:v.value,name:"TabPanel"})}}});export{ae as Tab,te as TabGroup,le as TabList,re as TabPanel,ne as TabPanels};
