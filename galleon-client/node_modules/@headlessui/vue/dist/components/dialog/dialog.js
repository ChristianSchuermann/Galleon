import{computed as f,defineComponent as y,h as v,inject as K,nextTick as ee,onMounted as M,onUnmounted as te,provide as le,ref as D,watchEffect as N}from"vue";import{render as P,Features as V}from'../../utils/render.js';import{Keys as oe}from'../../keyboard.js';import{useId as w}from'../../hooks/use-id.js';import{FocusTrap as R}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as ae}from'../../hooks/use-inert-others.js';import{Portal as Y,PortalGroup as re}from'../portal/portal.js';import{StackMessage as _,useStackProvider as ie}from'../../internal/stack-context.js';import{match as F}from'../../utils/match.js';import{ForcePortalRoot as j}from'../../internal/portal-force-root.js';import{Description as ne,useDescriptions as ue}from'../description/description.js';import{dom as U}from'../../utils/dom.js';import{useOpenClosed as se,State as q}from'../../internal/open-closed.js';import{useOutsideClick as pe}from'../../hooks/use-outside-click.js';import{getOwnerDocument as de}from'../../utils/owner.js';import{useEventListener as fe}from'../../hooks/use-event-listener.js';import{Hidden as ce,Features as ge}from'../../internal/hidden.js';import{disposables as me}from'../../utils/disposables.js';import{isIOS as ve}from'../../utils/platform.js';var De=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(De||{});let B=Symbol("DialogContext");function C(o){let u=K(B,null);if(u===null){let t=new Error(`<${o} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,C),t}return u}let k="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Ne=y({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:k},initialFocus:{type:Object,default:null}},emits:{close:o=>!0},setup(o,{emit:u,attrs:t,slots:s,expose:n}){var $;let c=D(!1);M(()=>{c.value=!0});let a=D(0),p=se(),h=f(()=>o.open===k&&p!==null?F(p.value,{[q.Open]:!0,[q.Closed]:!1}):o.open),x=D(new Set),g=D(null),H=D(null),I=f(()=>de(g));if(n({el:g,$el:g}),!(o.open!==k||p!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof h.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${h.value===k?void 0:o.open}`);let d=f(()=>c.value&&h.value?0:1),L=f(()=>d.value===0),T=f(()=>a.value>1),G=K(B,null)!==null,z=f(()=>T.value?"parent":"leaf");ae(g,f(()=>T.value?L.value:!1)),ie({type:"Dialog",enabled:f(()=>d.value===0),element:g,onUpdate:(l,e,i)=>{if(e==="Dialog")return F(l,{[_.Add](){x.value.add(i),a.value+=1},[_.Remove](){x.value.delete(i),a.value-=1}})}});let J=ue({name:"DialogDescription",slot:f(()=>({open:h.value}))}),Q=`headlessui-dialog-${w()}`,E=D(null),S={titleId:E,panelRef:D(null),dialogState:d,setTitleId(l){E.value!==l&&(E.value=l)},close(){u("close",!1)}};return le(B,S),pe(()=>{var e,i,m;return[...Array.from((i=(e=I.value)==null?void 0:e.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?i:[]).filter(r=>!(!(r instanceof HTMLElement)||r.contains(U(H))||S.panelRef.value&&r.contains(S.panelRef.value))),(m=S.panelRef.value)!=null?m:g.value]},(l,e)=>{S.close(),ee(()=>e==null?void 0:e.focus())},f(()=>d.value===0&&!T.value)),fe(($=I.value)==null?void 0:$.defaultView,"keydown",l=>{l.defaultPrevented||l.key===oe.Escape&&d.value===0&&(T.value||(l.preventDefault(),l.stopPropagation(),S.close()))}),N(l=>{var W;if(d.value!==0||G)return;let e=I.value;if(!e)return;let i=me();function m(O,b,X){let Z=O.style.getPropertyValue(b);return Object.assign(O.style,{[b]:X}),i.add(()=>{Object.assign(O.style,{[b]:Z})})}let r=e==null?void 0:e.documentElement,A=((W=e.defaultView)!=null?W:window).innerWidth-r.clientWidth;if(m(r,"overflow","hidden"),A>0){let O=r.clientWidth-r.offsetWidth,b=A-O;m(r,"paddingRight",`${b}px`)}if(ve()){i.addEventListener(e,"touchmove",b=>{b.preventDefault()},{passive:!1});let O=window.pageYOffset;i.add(()=>window.scrollTo(0,O))}l(i.dispose)}),N(l=>{if(d.value!==0)return;let e=U(g);if(!e)return;let i=new IntersectionObserver(m=>{for(let r of m)r.boundingClientRect.x===0&&r.boundingClientRect.y===0&&r.boundingClientRect.width===0&&r.boundingClientRect.height===0&&S.close()});i.observe(e),l(()=>i.disconnect())}),()=>{let l={...t,ref:g,id:Q,role:"dialog","aria-modal":d.value===0?!0:void 0,"aria-labelledby":E.value,"aria-describedby":J.value},{open:e,initialFocus:i,...m}=o,r={open:d.value===0};return v(j,{force:!0},()=>[v(Y,()=>v(re,{target:g.value},()=>v(j,{force:!1},()=>v(R,{initialFocus:i,containers:x,features:L.value?F(z.value,{parent:R.features.RestoreFocus,leaf:R.features.All&~R.features.FocusLock}):R.features.None},()=>P({ourProps:l,theirProps:m,slot:r,attrs:t,slots:s,visible:d.value===0,features:V.RenderStrategy|V.Static,name:"Dialog"}))))),v(ce,{features:ge.Hidden,ref:H})])}}}),Ve=y({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(o,{attrs:u,slots:t}){let s=C("DialogOverlay"),n=`headlessui-dialog-overlay-${w()}`;function c(a){a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),s.close())}return()=>P({ourProps:{id:n,"aria-hidden":!0,onClick:c},theirProps:o,slot:{open:s.dialogState.value===0},attrs:u,slots:t,name:"DialogOverlay"})}}),Ye=y({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(o,{attrs:u,slots:t,expose:s}){let n=C("DialogBackdrop"),c=`headlessui-dialog-backdrop-${w()}`,a=D(null);return s({el:a,$el:a}),M(()=>{if(n.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let p=o,h={id:c,ref:a,"aria-hidden":!0};return v(j,{force:!0},()=>v(Y,()=>P({ourProps:h,theirProps:{...u,...p},slot:{open:n.dialogState.value===0},attrs:u,slots:t,name:"DialogBackdrop"})))}}}),_e=y({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(o,{attrs:u,slots:t,expose:s}){let n=C("DialogPanel"),c=`headlessui-dialog-panel-${w()}`;s({el:n.panelRef,$el:n.panelRef});function a(p){p.stopPropagation()}return()=>{let p={id:c,ref:n.panelRef,onClick:a};return P({ourProps:p,theirProps:o,slot:{open:n.dialogState.value===0},attrs:u,slots:t,name:"DialogPanel"})}}}),Ue=y({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(o,{attrs:u,slots:t}){let s=C("DialogTitle"),n=`headlessui-dialog-title-${w()}`;return M(()=>{s.setTitleId(n),te(()=>s.setTitleId(null))}),()=>P({ourProps:{id:n},theirProps:o,slot:{open:s.dialogState.value===0},attrs:u,slots:t,name:"DialogTitle"})}}),qe=ne;export{Ne as Dialog,Ye as DialogBackdrop,qe as DialogDescription,Ve as DialogOverlay,_e as DialogPanel,Ue as DialogTitle};
